<!DOCTYPE html>
<html lang="en">
  <head>
    <title>3.4. Finland - Direct bank payment (via Paytrail)  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="3.4. Finland - Direct bank payment (via Paytrail)  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Pia Docs
        </a>
         (81% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">Pia Reference</a>
      <img class="carat" src="img/carat.png" />
      3.4. Finland - Direct bank payment (via Paytrail)  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="0-getting-started.html">0. Getting started</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="11-basic-payment-flow.html">1.1. Basic payment flow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="12-easy-one-click-payment-flow.html">1.2. Easy (one click) payment flow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="13-recurring-payments.html">1.3. Recurring payments</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="2-register-flow.html">2. Register flow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="31-apple-pay-integration.html">3.1. Apple Pay Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="32-paypal-integration.html">3.2. PayPal Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="33-vipps-swish-mobilepay-integration.html">3.3. Vipps, Swish, MobilePay Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="34-finland---direct-bank-payment-via-paytrail.html">3.4. Finland - Direct bank payment (via Paytrail)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="4-ui-customization.html">4. UI Customization</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="51-error-codes-handling.html">5.1. Error Codes Handling</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="52-terminology.html">5.2. Terminology</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="53-faqs.html">5.3. FAQs</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="54-backend-tips.html">5.4. Backend Tips</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="6-licenses.html">6. Licenses</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="7-changelog.html">7. Changelog</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="8-get-in-touch.html">8. Get in touch</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Categories.html">Categories</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Categories/NSError_28Wallets_29.html">NSError(Wallets)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CardPayment.html">CardPayment</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CardPaymentProcess.html">CardPaymentProcess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CardRegistrationResponse.html">CardRegistrationResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes.html#/c:objc(cs)CardStorage">CardStorage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MerchantDetails.html">MerchantDetails</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIApplePayInfo.html">NPIApplePayInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIApplePayShippingInfo.html">NPIApplePayShippingInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIError.html">NPIError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIInterfaceConfiguration.html">NPIInterfaceConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIMerchantInfo.html">NPIMerchantInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIOrderInfo.html">NPIOrderInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPITokenCardInfo.html">NPITokenCardInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPITransactionInfo.html">NPITransactionInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PaymentProcess.html">PaymentProcess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PiaSDK.html">PiaSDK</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PiaSDKController.html">PiaSDKController</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/RegistrationResponse.html">RegistrationResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/WalletPaymentProcess.html">WalletPaymentProcess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/WalletRegistrationResponse.html">WalletRegistrationResponse</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Constants.html">Constants</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@NPIPiaSemanticVersionString">NPIPiaSemanticVersionString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@NPIPiaTechnicalVersionString">NPIPiaTechnicalVersionString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@PiaVersionNumber">PiaVersionNumber</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@PiaVersionString">PiaVersionString</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PiALanguage.html">PiALanguage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/SchemeType.html">SchemeType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Wallet.html">Wallet</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/WalletErrorCode.html">WalletErrorCode</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PiaSDKDelegate.html">PiaSDKDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PiaSDKTheme.html">PiaSDKTheme</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/WalletPaymentDelegate.html">WalletPaymentDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Type Definitions.html">Type Definitions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PaymentRegistration.h@T@CardError">CardError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PaymentRegistration.h@T@CompletionCallback">CompletionCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PaymentProcess.h@T@Currency">Currency</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PaymentRegistration.h@T@FailureCompletionCallback">FailureCompletionCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions/NPIErrorCode.html">NPIErrorCode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PaymentRegistration.h@T@RedirectURL">RedirectURL</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PaymentRegistration.h@T@TransactionCallback">TransactionCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PaymentRegistration.h@T@TransactionID">TransactionID</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:NSError+Wallets.h@T@WalletError">WalletError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PaymentRegistration.h@T@WalletFailureWithError">WalletFailureWithError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PaymentRegistration.h@T@WalletRedirectWithoutInterruption">WalletRedirectWithoutInterruption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PaymentRegistration.h@T@WalletURL">WalletURL</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PaymentRegistration.h@T@WalletURLCallback">WalletURLCallback</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <h1 id='finland-direct-bank-payment-via-paytrail' class='heading'>Finland: Direct bank payment (via Paytrail)</h1>

<p>With the PiA SDK, you can allow Finnish customers to pay with Paytrail direct bank transfers. It supports through 1 integration, the 10 main banks which are part of this direct payment scheme.</p>

<p>You can get more information about Paytrail via Netaxept from the <a href="https://shop.nets.eu/documents/535922/545797/Netaxept_Paytrail_GetStartedGuide_EN_v1.7.pdf/182ad7e8-ad0d-4c6f-9a74-bd8508300177">Paytrail Getting Started Guide</a>.</p>

<p><strong>Pre-requisite to accept direct bank payments via Paytrail :</strong></p>

<ul>
<li><p>The merchant needs to sign a direct bank payments agreement with Netaxept and make sure these agreements are added in the Netaxept account.</p></li>
<li><p>App design: Bank icons are available in the <a href="https://github.com/Nets-mobile-acceptance/Netaxept-iOS-SDK/tree/master/Resources">resources</a> folder (optional).</p></li>
</ul>

<p><strong>Specific information to initiate direct bank payments via Paytrail :</strong></p>

<ul>
<li><p>Merchant needs to use <code>ServiceType = B</code> while making the register call.</p></li>
<li><p>Paytrail requires a set of customer details that need to be sent in the register call to Netaxpet. Merchants can use dummy data for this. Check the <a href="https://shop.nets.eu/documents/535922/545797/Netaxept_Paytrail_GetStartedGuide_EN_v1.7.pdf/182ad7e8-ad0d-4c6f-9a74-bd8508300177">Netaxept Paytrail Integration Guide</a> for more details.</p></li>
<li><p>Paytrail requires a unique reference number which is formulated according to Finnish reference number standard <a href="www.fkl.fi">www.fkl.fi</a>. For more information click <a href="https://shop.nets.eu/web/partners/transaction-reference">here</a>.</p></li>
</ul>

<table><thead>
<tr>
<th style="text-align: center">Paytrail Flow</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center"><img src="./Resources/Paytrail.gif" alt=""></td>
</tr>
</tbody></table>

<p>Here is the flow diagram for Paytrail payment:</p>

<p><img src="./img/Paytrail%20Payment%20Flow.png" alt="Paytrail Payment Flow"></p>

<p><strong>Initializing a payment with Paytrail</strong></p>

<ul>
<li>The merchant app needs to make a register call to Netaxept which will reutrn a <code>transactionId</code> which needs to be passed to the SDK along with the <code>merchantId</code> and <code>testMode</code> to initiate Paytrail payment.</li>
</ul>

<p>The following is an example of Paytrail payment registeration and initialization</p>
<pre class="highlight swift"><code>
    <span class="kd">func</span> <span class="nf">openFinnishBankPayment</span><span class="p">(</span><span class="nv">sender</span><span class="p">:</span> <span class="kt">PaymentSelectionController</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">registerPayment</span><span class="p">{</span> <span class="p">(</span><span class="n">transactionInfo</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="kt">PiaSDKController</span><span class="p">(</span><span class="nv">paytrailBankPaymentWithMerchantID</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">merchant</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nv">transactionInfo</span><span class="p">:</span> <span class="n">transactionInfo</span><span class="p">,</span> <span class="nv">testMode</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">isTestMode</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">registerPayment</span><span class="p">(</span>
        <span class="n">withPaytrailWithCompletion</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">NPITransactionInfo</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Create a registration request body with order, payment and customer details</span>
        <span class="c1">// The sample backend identifies Paytrail with its method ID:</span>
        <span class="c1">// `PaymentMethodID(id: "PaytrailNordea", displayName: "PaytrailNordea", fee: 0)`</span>
        <span class="k">let</span> <span class="nv">requestBody</span><span class="p">:</span> <span class="kt">RegistrationRequest</span> <span class="c1">// see section: Backend Models (1.1)</span>

        <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">makeRegisterRequest</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">requestBody</span><span class="p">)</span> <span class="p">{</span> <span class="n">transaction</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">transaction</span> <span class="o">=</span> <span class="n">transaction</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="c1">// handle error</span>
            <span class="p">}</span>

            <span class="c1">// Grab the transaction ID, its used to later commit/rollback the registration</span>
            <span class="c1">// The SDK will callback the delegate with success/error result</span>
            <span class="c1">// Customer app is responsible for displaying the result to user</span>
            <span class="k">self</span><span class="o">.</span><span class="n">transaction</span> <span class="o">=</span> <span class="n">transaction</span>

            <span class="nf">completionHandler</span><span class="p">(</span><span class="n">transaction</span><span class="p">?</span><span class="o">.</span><span class="n">npiTransaction</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

   <span class="kd">func</span> <span class="nf">present</span><span class="p">(</span><span class="n">_</span> <span class="nv">piaController</span><span class="p">:</span> <span class="kt">PiaSDKController</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">piaController</span><span class="o">.</span><span class="n">piaDelegate</span> <span class="o">=</span> <span class="k">self</span>
        <span class="n">navigationController</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="n">piaController</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="p">}</span>

</code></pre>

<p>After the transaction has been registered, PiA SDK will send to Netaxept the <code>merchantId</code> and the <code>transactionId</code> and Netaxept will send back the url for performing the Paytrail payment which will be loaded inside a webView.</p>

<p>The <strong>PiaSDKController</strong> instance should also have a valid delegate. The SDK will notify the app when the Paytrail transaction is completed or the user cancels the process through the below mentioned delegate methods. </p>
<pre class="highlight swift"><code>
    <span class="kd">func</span> <span class="nf">piaSDKDidComplete</span><span class="p">(</span><span class="n">withSuccess</span> <span class="nv">piaController</span><span class="p">:</span> <span class="kt">PiaSDKController</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//commit transaction</span>
    <span class="p">}</span>

    <span class="c1">/// Called when user cancels the transaction.</span>
    <span class="kd">func</span> <span class="nf">piaSDKDidCancel</span><span class="p">(</span><span class="n">_</span> <span class="nv">piaController</span><span class="p">:</span> <span class="kt">PiaSDKController</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// User canceled/interrupted payment process</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">piaSDK</span><span class="p">(</span><span class="n">_</span> <span class="nv">piaController</span><span class="p">:</span> <span class="kt">PiaSDKController</span><span class="p">,</span> <span class="n">didFailWithError</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">NPIError</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// Handle error</span>
    <span class="p">}</span>
</code></pre>

<p>Note: Netaxept backend integration tips can be found in <em>5.4 Backend Tips</em>,  <em>Request body - Paytrail payment registration</em> <a href="./54-backend-tips.html#request-body-paytrail-payment-registration">section</a></p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2020 <a class="link" href="https://nets.eu" target="_blank" rel="external">Nets</a>. All rights reserved. (Last updated: 2020-10-27)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.0</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
