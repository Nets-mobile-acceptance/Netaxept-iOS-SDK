<!DOCTYPE html>
<html lang="en">
  <head>
    <title>1.1. Basic payment flow  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="1.1. Basic payment flow  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Pia Docs
        </a>
         (95% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">Pia Reference</a>
      <img class="carat" src="img/carat.png" />
      1.1. Basic payment flow  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="0-getting-started.html">0. Getting started</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="11-basic-payment-flow.html">1.1. Basic payment flow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="12-easy-one-click-payment-flow.html">1.2. Easy (one click) payment flow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="13-recurring-payments.html">1.3. Recurring payments</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="2-register-flow.html">2. Register flow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="31-apple-pay-integration.html">3.1. Apple Pay Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="32-paypal-integration.html">3.2. PayPal Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="33-vipps-integration.html">3.3. Vipps Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="34-swish-m-commerce-integration.html">3.4. Swish m-commerce Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="4-ui-customization.html">4. UI Customization</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="51-error-codes-handling.html">5.1. Error Codes Handling</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="52-terminology.html">5.2. Terminology</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="53-faqs.html">5.3. FAQs</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="54-backend-tips.html">5.4. Backend Tips</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="6-licenses.html">6. Licenses</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="7-changelog.html">7. Changelog</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="8-get-in-touch.html">8. Get in touch</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIApplePayInfo.html">NPIApplePayInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIApplePayShippingInfo.html">NPIApplePayShippingInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIError.html">NPIError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIInterfaceConfiguration.html">NPIInterfaceConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIMerchantInfo.html">NPIMerchantInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIOrderInfo.html">NPIOrderInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPITokenCardInfo.html">NPITokenCardInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPITransactionInfo.html">NPITransactionInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PiaSDK.html">PiaSDK</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PiaSDKController.html">PiaSDKController</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Constants.html">Constants</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@NPIPiaSemanticVersionString">NPIPiaSemanticVersionString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@NPIPiaTechnicalVersionString">NPIPiaTechnicalVersionString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@PiaVersionNumber">PiaVersionNumber</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@PiaVersionString">PiaVersionString</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PiALanguage.html">PiALanguage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/SchemeType.html">SchemeType</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PiaSDKDelegate.html">PiaSDKDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/SwishPaymentDelegate.html">SwishPaymentDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/VippsPaymentDelegate.html">VippsPaymentDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/WalletPaymentDelegate.html">WalletPaymentDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Type Definitions.html">Type Definitions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions/NPIErrorCode.html">NPIErrorCode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PiaSDK.h@T@URLScheme">URLScheme</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PiaSDK.h@T@VippsStatusCode">VippsStatusCode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PiaSDK.h@T@WalletURL">WalletURL</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <h1 id='basic-payment-flow-description' class='heading'>Basic payment flow description</h1>

<p>Below you can find the interaction between the application that uses the <strong>PiA SDK</strong> and the
SDK to start the <strong>basic payment flow</strong> by using the payment card:</p>

<p><img src="./img/Basic%20Payment%20Flow.png" alt="Basic Payment flow"></p>

<p>In the basic payment flow, <strong>PiaSDKController</strong> should be instantiated with the following parameters:</p>

<ul>
<li><p><strong>merchantInfo</strong> - Uniquely identifies the merchant</p>
<pre class="highlight swift"><code><span class="cm">/**
 @param identifier Merchant id provided by Nets. Must not be nil.
*/</span>
<span class="o">-</span> <span class="p">(</span><span class="n">instancetype</span> <span class="n">_Nonnull</span><span class="p">)</span><span class="nv">initWithIdentifier</span><span class="p">:(</span><span class="kt">NSString</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">)</span><span class="n">identifier</span><span class="p">;</span>

<span class="cm">/**
 @param identifier Merchant id provided by Nets. Must not be nil.
 @param testMode Default is false, set it to true to use Netaxept's test environment
*/</span>
<span class="o">-</span> <span class="p">(</span><span class="n">instancetype</span> <span class="n">_Nonnull</span><span class="p">)</span><span class="nv">initWithIdentifier</span><span class="p">:(</span><span class="kt">NSString</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">)</span><span class="n">identifier</span> <span class="nv">testMode</span><span class="p">:(</span><span class="kt">BOOL</span><span class="p">)</span><span class="n">testMode</span><span class="p">;</span>

<span class="cm">/**
 @param identifier Merchant id provided by Nets. Must not be nil.
 @param testMode Default is false, set it to true to use Netaxept's test environment
 @param cvcRequired Default is true, set it to false to make payments without Security Code
 Important: Note that disabling Security Code entry by setting _cvcRequired=False_ is submitted to both approval from your acquirer and activation by Netaxept customer service. Before proceeding, please contact your Netaxept customer service.
 */</span>
<span class="o">-</span> <span class="p">(</span><span class="n">instancetype</span> <span class="n">_Nonnull</span><span class="p">)</span><span class="nv">initWithIdentifier</span><span class="p">:(</span><span class="kt">NSString</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">)</span><span class="n">identifier</span> <span class="nv">testMode</span><span class="p">:(</span><span class="kt">BOOL</span><span class="p">)</span><span class="n">testMode</span> <span class="nv">cvcRequired</span><span class="p">:(</span><span class="kt">BOOL</span><span class="p">)</span><span class="n">cvcRequired</span><span class="p">;</span>
</code></pre></li>
<li><p><strong>orderInfo</strong> - Describes the amount to be paid and the currency to be used</p></li>
<li><p><strong>tokenCardInfo</strong> - Saved card token. This is optional - if nil, the user will have to input his card details</p></li>
</ul>
<pre class="highlight swift"><code><span class="n">boolean</span> <span class="n">testMode</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">//Notify the SDK to use the test environment</span>
<span class="k">let</span> <span class="nv">merchantInfo</span> <span class="o">=</span> <span class="kt">NPIMerchantInfo</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"your merchant ID here, provided by Nets"</span><span class="p">,</span> <span class="n">testMode</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">orderInfo</span> <span class="o">=</span> <span class="kt">NPIOrderInfo</span><span class="p">(</span><span class="nv">amount</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span><span class="mf">4.5</span><span class="p">),</span> <span class="nv">currencyCode</span><span class="p">:</span> <span class="s">"EUR"</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">piaSDK</span> <span class="o">=</span> <span class="kt">PiaSDKController</span><span class="p">(</span><span class="nv">merchantInfo</span><span class="p">:</span> <span class="n">merchantInfo</span><span class="p">,</span> <span class="nv">orderInfo</span><span class="p">:</span> <span class="n">orderInfo</span><span class="p">,</span> <span class="nv">tokenCardInfo</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="n">piaSDK</span><span class="o">.</span><span class="n">piaDelegate</span> <span class="o">=</span> <span class="k">self</span>
<span class="k">self</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="n">piaSDK</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</code></pre>

<p>The <strong>PiaSDKController</strong> instance should also have a valid delegate. The SDK will notify the app when it needs to register the payment by calling <code>doInitialAPICall</code>. After the app registers the transaction, it should call the <code>completionHandler</code> received as a parameter to pass back the transactionInfo to PiA SDK.</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">YourViewController</span> <span class="p">:</span> <span class="kt">NPIPaymentViewControllerDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">doInitialAPICall</span><span class="p">(</span><span class="n">_</span> <span class="kt">PiaSDKController</span><span class="p">:</span> <span class="kt">PiaSDKController</span><span class="p">,</span> <span class="nv">storeCard</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">,</span> <span class="n">withCompletion</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">NPITransactionInfo</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">postRegisterPayment</span><span class="p">(</span><span class="nv">storeCard</span><span class="p">:</span> <span class="n">storeCard</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">completionHandler</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">transactionInfo</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

   <span class="kd">func</span> <span class="nf">postRegisterPayment</span><span class="p">(</span><span class="nv">storeCard</span><span class="p">:</span><span class="kt">Bool</span><span class="p">,</span> <span class="nv">completed</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">orderNumber</span> <span class="o">=</span> <span class="s">"your unique order identifier"</span>
        <span class="k">var</span> <span class="nv">method</span><span class="p">:</span><span class="kt">Method</span><span class="p">?</span>
        <span class="k">let</span> <span class="nv">customerId</span> <span class="o">=</span> <span class="s">"your unique customer id"</span>

        <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">cardId</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="n">method</span> <span class="o">=</span> <span class="kt">Method</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"EasyPayment"</span><span class="p">,</span> <span class="nv">displayName</span><span class="p">:</span> <span class="s">"Easy Payment"</span><span class="p">,</span> <span class="nv">fee</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">params</span> <span class="o">=</span> <span class="kt">PaymentRegisterRequest</span><span class="p">(</span><span class="nv">customerId</span><span class="p">:</span> <span class="n">customerId</span><span class="p">,</span> <span class="nv">orderNumber</span><span class="p">:</span> <span class="n">orderNumber</span><span class="p">,</span> <span class="nv">amount</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">amount</span><span class="o">!</span><span class="p">,</span> <span class="nv">method</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span> <span class="nv">cardId</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">cardId</span><span class="p">,</span> <span class="nv">storeCard</span><span class="p">:</span><span class="n">storeCard</span><span class="p">,</span> <span class="nv">items</span><span class="p">:</span> <span class="kc">nil</span> <span class="p">)</span>

        <span class="kt">RequestManager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">postRegister</span><span class="p">(</span><span class="nv">parameters</span><span class="p">:</span> <span class="n">params</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">res</span><span class="p">):</span>
                <span class="k">self</span><span class="o">.</span><span class="n">transactionInfo</span> <span class="o">=</span> <span class="kt">NPITransactionInfo</span><span class="p">(</span><span class="nv">transactionID</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">transactionId</span><span class="p">,</span> <span class="nv">okRedirectUrl</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">redirectOK</span><span class="p">)</span>
                <span class="nf">completed</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">err</span><span class="p">):</span>
                <span class="nf">completed</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre>

<p>Note: Netaxept backend integration tips can be found in <em>5.4 Backend Tips</em>,  <em>Register API</em> <a href="./54-backend-tips.html#register-api">section</a></p>
<h2 id='delegate' class='heading'>Delegate</h2>

<p>After the transaction has been registered, an unique transaction identifier <code>transactionID</code> will
be returned from Netaxept to <strong>PiA SDK</strong> and <strong>PiA SDK</strong> will post it along with the card data to
the Netaxept. In addition, an <code>okRedirectUrl</code> is required by <strong>PiA SDK</strong> so as that SDK can
be notified by Netaxept after payment card data has been delivered to Netaxept successfully.
During this phase, the 3DS authentication is performed as well unless it has been
waived by your chosen card acquirer.</p>

<p>In the end, the PiaSDKController <strong>delegate</strong> will be notified when SDK
handling is completed by getting a call to one of the following methods:</p>

<ul>
<li><p>func piaSDK(_ PiaSDK: PiaSDKController, didFailWithError error: NPIError)</p></li>
<li><p>func piaSDKDidComplete(withSuccess PiaSDK: PiaSDKController)</p></li>
<li><p>func piaSDKDidCompleteSaveCard(withSuccess PiaSDK: PiaSDKController)</p></li>
<li><p>func piaSDKDidCancel(_ PiaSDK: PiaSDKController)</p></li>
</ul>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2019 <a class="link" href="https://nets.eu" target="_blank" rel="external">Nets</a>. All rights reserved. (Last updated: 2019-10-25)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.0</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
