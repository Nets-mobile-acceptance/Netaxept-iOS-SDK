<!DOCTYPE html>
<html lang="en">
  <head>
    <title>3.2. PayPal Integration  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="3.2. PayPal Integration  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Pia Docs
        </a>
         (95% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">Pia Reference</a>
      <img class="carat" src="img/carat.png" />
      3.2. PayPal Integration  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="0-getting-started.html">0. Getting started</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="11-basic-payment-flow.html">1.1. Basic payment flow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="12-easy-one-click-payment-flow.html">1.2. Easy (one click) payment flow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="13-recurring-payments.html">1.3. Recurring payments</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="2-register-flow.html">2. Register flow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="31-apple-pay-integration.html">3.1. Apple Pay Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="32-paypal-integration.html">3.2. PayPal Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="33-vipps-integration.html">3.3. Vipps Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="34-swish-m-commerce-integration.html">3.4. Swish m-commerce Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="35-finland---direct-bank-payment-via-paytrail.html">3.5. Finland - Direct bank payment (via Paytrail)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="36--mobilepay-integration.html">3.6  MobilePay Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="4-ui-customization.html">4. UI Customization</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="51-error-codes-handling.html">5.1. Error Codes Handling</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="52-terminology.html">5.2. Terminology</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="53-faqs.html">5.3. FAQs</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="54-backend-tips.html">5.4. Backend Tips</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="6-licenses.html">6. Licenses</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="7-changelog.html">7. Changelog</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="8-get-in-touch.html">8. Get in touch</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIApplePayInfo.html">NPIApplePayInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIApplePayShippingInfo.html">NPIApplePayShippingInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIError.html">NPIError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIInterfaceConfiguration.html">NPIInterfaceConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIMerchantInfo.html">NPIMerchantInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIOrderInfo.html">NPIOrderInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPITokenCardInfo.html">NPITokenCardInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPITransactionInfo.html">NPITransactionInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PiaSDK.html">PiaSDK</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PiaSDKController.html">PiaSDKController</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Constants.html">Constants</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@NPIPiaSemanticVersionString">NPIPiaSemanticVersionString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@NPIPiaTechnicalVersionString">NPIPiaTechnicalVersionString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@PiaVersionNumber">PiaVersionNumber</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@PiaVersionString">PiaVersionString</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PiALanguage.html">PiALanguage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/SchemeType.html">SchemeType</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/MobilePayDelegate.html">MobilePayDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PiaSDKDelegate.html">PiaSDKDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/SwishPaymentDelegate.html">SwishPaymentDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/VippsPaymentDelegate.html">VippsPaymentDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/WalletPaymentDelegate.html">WalletPaymentDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Type Definitions.html">Type Definitions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions/NPIErrorCode.html">NPIErrorCode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PiaSDK.h@T@URLScheme">URLScheme</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PiaSDK.h@T@VippsStatusCode">VippsStatusCode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions.html#/c:PiaSDK.h@T@WalletURL">WalletURL</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <h1 id='paypal-integration' class='heading'>PayPal Integration</h1>

<p>PayPal transaction is similar to other card schemes flows with <strong>PiA SDK</strong>. Thus, in order to initialize PayPal transaction, <code><a href="Classes/PiaSDKController.html">PiaSDKController</a></code> should be instantiated with the following parameters:</p>

<ul>
<li><strong>merchantInfo</strong> - Uniquely identifies the merchant</li>
</ul>
<pre class="highlight swift"><code><span class="n">boolean</span> <span class="n">testMode</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">//Notify the SDK to use the test environment</span>
<span class="k">let</span> <span class="nv">merchantInfo</span> <span class="o">=</span> <span class="kt">NPIMerchantInfo</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"your merchant ID here, provided by Nets"</span><span class="p">,</span> <span class="n">testMode</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">piaSDK</span> <span class="o">=</span> <span class="kt">PiaSDKController</span><span class="p">(</span><span class="nv">merchantInfo</span><span class="p">:</span> <span class="n">merchantInfo</span><span class="p">,</span> <span class="nv">payWithPayPal</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
<span class="n">piaSDK</span><span class="o">.</span><span class="n">piaDelegate</span> <span class="o">=</span> <span class="k">self</span>
<span class="k">self</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="n">piaSDK</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</code></pre>

<p>The <strong>PiaSDKController</strong> instance should also have a valid delegate. The SDK will notify the app when it needs to register the payment by calling <code>registerPaymentWithPayPal</code>. The app should register the transaction, then call the <code>completionHandler</code> received as a parameter to pass back the transactionInfo to PiA SDK.</p>
<pre class="highlight swift"><code>
<span class="c1">// MARK: PiaSDK Delegate - PayPal registration</span>

<span class="kd">func</span> <span class="nf">registerPayment</span><span class="p">(</span>
    <span class="n">withPayPal</span> <span class="nv">piaController</span><span class="p">:</span> <span class="kt">PiaSDKController</span><span class="p">,</span>
    <span class="n">withCompletion</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">NPITransactionInfo</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Create a registration request body with order and payment details </span>
    <span class="c1">// The sample backend identifies PayPal with its method ID:  </span>
    <span class="c1">// `PaymentMethodID(id: "PayPal", displayName: "PayPal", fee: 0)`</span>
    <span class="k">let</span> <span class="nv">requestBody</span><span class="p">:</span> <span class="kt">RegistrationRequest</span> <span class="c1">// see section: Backend Models (1.1)</span>

    <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">makeRegisterRequest</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">requestBody</span><span class="p">)</span> <span class="p">{</span> <span class="n">transaction</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">transaction</span> <span class="o">=</span> <span class="n">transaction</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="c1">// handle error</span>
        <span class="p">}</span>

        <span class="c1">// Grab the transaction ID, its used to later commit/rollback the registration</span>
        <span class="c1">// The SDK will callback the delegate with success/error result</span>
        <span class="c1">// Customer app is responsible for displaying the result to user</span>
        <span class="k">self</span><span class="o">.</span><span class="n">transaction</span> <span class="o">=</span> <span class="n">transaction</span>

        <span class="c1">// Notify Pia SDK with registration result</span>
        <span class="nf">completionHandler</span><span class="p">(</span><span class="kt">NPITransactionInfo</span><span class="p">(</span>
            <span class="nv">transactionID</span><span class="p">:</span> <span class="n">transaction</span><span class="o">.</span><span class="n">transactionId</span><span class="p">,</span>
            <span class="nv">redirectUrl</span><span class="p">:</span> <span class="n">transaction</span><span class="o">.</span><span class="n">redirectOK</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>After the transaction has been registered, PiA SDK will send to Netaxept the merchant identifier and the transaction id and Netaxept will send back the url for performing the PayPal payment which will be loaded inside a webView. The webView will look like below: 
<img src="./Resources/PayPal.jpeg" alt=""></p>

<p>After the transaction is performed inside PayPal webView, depending on the result, one of these methods of the PiA delegate will be called:</p>

<ul>
<li><p>func piaSDKDidComplete(withSuccess PiaSDK: PiaSDKController)</p></li>
<li><p>func piaSDK(_ PiaSDK: PiaSDKController, didFailWithError error: NPIError)</p></li>
</ul>

<p>In case the user has cancelled the payment, this method will be called:</p>

<ul>
<li>func piaSDKDidCancel(_ PiaSDK: PiaSDKController)</li>
</ul>

<p>Note: Netaxept backend integration tips can be found in <em>5.4 Backend Tips</em>,  <em>Request body - Pay Pal payment registration</em> <a href="./54-backend-tips.html#request-body-pay-pal-payment-registration">section</a></p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2020 <a class="link" href="https://nets.eu" target="_blank" rel="external">Nets</a>. All rights reserved. (Last updated: 2020-09-09)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.0</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
