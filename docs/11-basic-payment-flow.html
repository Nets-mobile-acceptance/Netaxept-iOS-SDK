<!DOCTYPE html>
<html lang="en">
  <head>
    <title>1.1. Basic payment flow  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="1.1. Basic payment flow  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Pia Docs
        </a>
         (68% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">Pia Reference</a>
      <img class="carat" src="img/carat.png" />
      1.1. Basic payment flow  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="0-getting-started.html">0. Getting started</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="11-basic-payment-flow.html">1.1. Basic payment flow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="12-easy-one-click-payment-flow.html">1.2. Easy (one click) payment flow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="13-recurring-payments.html">1.3. Recurring payments</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="2-saving-a-card.html">2. Saving a card</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="31-apple-pay-integration.html">3.1. Apple Pay Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="32-paypal-integration.html">3.2. PayPal Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="33-vipps-swish-mobilepay-integration.html">3.3. Vipps, Swish, MobilePay Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="34-finland---direct-bank-payment-via-paytrail.html">3.4. Finland - Direct bank payment (via Paytrail)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="4-ui-customization.html">4. UI Customization</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="51-error-codes-handling.html">5.1. Error Codes Handling</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="52-terminology.html">5.2. Terminology</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="53-faqs.html">5.3. FAQs</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="54-backend-tips.html">5.4. Backend Tips</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="6-licenses.html">6. Licenses</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="7-changelog.html">7. Changelog</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="8-get-in-touch.html">8. Get in touch</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Categories.html">Categories</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Categories/NSError_28Wallets_29.html">NSError(Wallets)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CardDisplay.html">CardDisplay</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CardPayment.html">CardPayment</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CardPaymentProcess.html">CardPaymentProcess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CardRegistrationResponse.html">CardRegistrationResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CardStorage.html">CardStorage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MerchantDetails.html">MerchantDetails</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIApplePayInfo.html">NPIApplePayInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIApplePayShippingInfo.html">NPIApplePayShippingInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIError.html">NPIError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIInterfaceConfiguration.html">NPIInterfaceConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIMerchantInfo.html">NPIMerchantInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIOrderInfo.html">NPIOrderInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPITokenCardInfo.html">NPITokenCardInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPITransactionInfo.html">NPITransactionInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PayPalPaymentProcess.html">PayPalPaymentProcess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PayPalRegistrationResponse.html">PayPalRegistrationResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PaymentProcess.html">PaymentProcess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PaytrailPaymentProcess.html">PaytrailPaymentProcess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PaytrailRegistrationResponse.html">PaytrailRegistrationResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PiaSDK.html">PiaSDK</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PiaSDKController.html">PiaSDKController</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/RegistrationResponse.html">RegistrationResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TokenizedCardExpressCheckout.html">TokenizedCardExpressCheckout</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TokenizedCardPayment.html">TokenizedCardPayment</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TokenizedCardPrompt.html">TokenizedCardPrompt</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TokenizedCardPromptConfirmation.html">TokenizedCardPromptConfirmation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes.html#/c:objc(cs)TokenizedCardPromptNone">TokenizedCardPromptNone</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/WalletPaymentProcess.html">WalletPaymentProcess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/WalletRegistrationResponse.html">WalletRegistrationResponse</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Constants.html">Constants</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@NPIPiaSemanticVersionString">NPIPiaSemanticVersionString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@NPIPiaTechnicalVersionString">NPIPiaTechnicalVersionString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@PiaVersionNumber">PiaVersionNumber</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@PiaVersionString">PiaVersionString</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Card.html">Card</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/CardScheme.html">CardScheme</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PayButtonTextLabelOption.html">PayButtonTextLabelOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PiALanguage.html">PiALanguage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/SchemeType.html">SchemeType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Wallet.html">Wallet</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/WalletErrorCode.html">WalletErrorCode</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PaymentRegistering.html">PaymentRegistering</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PaymentRegistrationResult.html">PaymentRegistrationResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PiaSDKDelegate.html">PiaSDKDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PiaSDKTheme.html">PiaSDKTheme</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Type%20Definitions.html">Type Definitions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@CardError">CardError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@CardRegistrationCallback">CardRegistrationCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@CompletionCallback">CompletionCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentProcess.h@T@Currency">Currency</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@FailureCompletionCallback">FailureCompletionCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions/NPIErrorCode.html">NPIErrorCode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@PayPalRegistrationCallback">PayPalRegistrationCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@PaymentProcessCompletion">PaymentProcessCompletion</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@PaymentProcessFailure">PaymentProcessFailure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@PaytrailRegistrationCallback">PaytrailRegistrationCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@RedirectURL">RedirectURL</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@TokenizableCardRegistrationCallback">TokenizableCardRegistrationCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@TokenizeCardForLaterUse">TokenizeCardForLaterUse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@TransactionCallback">TransactionCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@TransactionCompletion">TransactionCompletion</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@TransactionID">TransactionID</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:NSError+Wallets.h@T@WalletError">WalletError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@WalletFailureWithError">WalletFailureWithError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@WalletRedirectWithoutInterruption">WalletRedirectWithoutInterruption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@WalletURL">WalletURL</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@WalletURLCallback">WalletURLCallback</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/c:@F@isSBusinessInitiated">isSBusinessInitiated</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <h1 id='basic-payment-flow-description' class='heading'>Basic payment flow description</h1>

<p>Basic payment flow refers to card payment or card storage using the Pia SDK. The SDK offers a view controller 
for card entry and 3DS authentication unless it has been waived by your chosen card acquirer. This integration guide explains the steps required for a successful card payment 
and card storage process using the SDK. </p>

<p><img src="./img/Basic%20Payment%20Flow.png" alt="Basic Payment flow"></p>

<p>For a card payment, create a card-payment process providing merchant information (obtained from Netaxept), the amount to be charged (in cents), the currency code and registration callback as shown below:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">merchantDetails</span> <span class="o">=</span> <span class="kt">MerchantDetails</span><span class="o">.</span><span class="nf">merchant</span><span class="p">(</span><span class="nv">withID</span><span class="p">:</span> <span class="n">merchantID</span><span class="p">,</span> <span class="nv">inTest</span><span class="p">:</span> <span class="n">isTestMerchantID</span><span class="p">)</span>


<span class="k">let</span> <span class="nv">cardPayment</span> <span class="o">=</span> <span class="kt">PaymentProcess</span><span class="o">.</span><span class="nf">cardPayment</span><span class="p">(</span>
    <span class="nv">withMerchant</span><span class="p">:</span> <span class="n">merchantDetails</span><span class="p">,</span>
    <span class="nv">amount</span><span class="p">:</span> <span class="n">amountInCents</span><span class="p">,</span>
    <span class="nv">currency</span><span class="p">:</span> <span class="n">currencyCode</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="n">userSelectedToStoreCard</span><span class="p">,</span> <span class="n">callback</span> <span class="k">in</span>

           <span class="c1">// Make the registeration call here and retrun the callback</span>
           <span class="nf">registerCardPayment</span><span class="p">(</span><span class="n">userSelectedToStoreCard</span><span class="p">,</span><span class="n">callback</span><span class="p">)</span>
     <span class="p">}</span>


</code></pre>

<p><em>Note:</em> If you do not support certain card schemes that are supported by the SDK, pass an exclude-card-scheme set to exclude the card schemes and present user with &ldquo;This card is not supported&rdquo; message during card entry. </p>
<pre class="highlight swift"><code><span class="c1">// Exclude Amex and Visa from supported card scheme list. </span>
<span class="k">let</span> <span class="nv">cardPayment</span> <span class="o">=</span> <span class="kt">PaymentProcess</span><span class="o">.</span><span class="nf">cardPayment</span><span class="p">(</span>
    <span class="nv">withMerchant</span><span class="p">:</span> <span class="n">merchantDetails</span><span class="p">,</span>
    <span class="nv">excludedCardSchemeSet</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">amex</span><span class="p">,</span> <span class="o">.</span><span class="n">visa</span><span class="p">]</span>
    <span class="nv">amount</span><span class="p">:</span> <span class="n">amountInCents</span><span class="p">,</span>
    <span class="nv">currency</span><span class="p">:</span> <span class="n">currencyCode</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="n">userSelectedToStoreCard</span><span class="p">,</span> <span class="n">callback</span> <span class="k">in</span>

           <span class="c1">// Make the registeration call here and retrun the callback</span>
           <span class="nf">registerCardPayment</span><span class="p">(</span><span class="n">userSelectedToStoreCard</span><span class="p">,</span><span class="n">callback</span><span class="p">)</span>
     <span class="p">}</span>

</code></pre>
<h3 id='main-card-schemes-visa-mastercard-amex-dankort' class='heading'>Main card schemes (Visa, MasterCard, Amex, Dankort, &hellip;)</h3>

<p>The SDK offers a declarative API to instantiate a controller for card payment and card storage processes with result callbacks for <em>success</em>, <em>cancellation</em> and <em>failure</em>. Present this controller and handle the callbacks accordingly. </p>
<pre class="highlight swift"><code>
<span class="kt">PiaSDK</span><span class="o">.</span><span class="nf">controller</span><span class="p">(</span>
    <span class="nv">for</span><span class="p">:</span> <span class="n">cardPayment</span><span class="p">,</span>
    <span class="nv">success</span><span class="p">:</span> <span class="p">{</span> <span class="n">piaController</span><span class="p">,</span> <span class="n">transactionId</span> <span class="k">in</span>  <span class="p">},</span>        <span class="c1">// Commit the transaction with your merchant backend</span>
    <span class="nv">cancellation</span><span class="p">:</span> <span class="p">{</span> <span class="n">piaController</span><span class="p">,</span> <span class="n">transactionId</span> <span class="k">in</span> <span class="p">},</span>    <span class="c1">// User canceled, rollback the transaction</span>
    <span class="nv">failure</span><span class="p">:</span> <span class="p">{</span> <span class="n">piaController</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span><span class="p">}</span>                   <span class="c1">// Rollback transaction, check error object for detail. </span>
<span class="p">)</span>
</code></pre>
<h3 id='s-business-card' class='heading'>S-Business Card</h3>

<p>The SDK offers a declarative API to instantiate a controller for S-Business card payment and card storage processes with result callbacks for <em>success</em>, <em>cancellation</em> and <em>failure</em>. Present this controller and handle the callbacks accordingly. </p>
<pre class="highlight plaintext"><code>
###Co-Branded card (Danish merchants only)

Due to EU legislation and local cobranded card rules in Denmark, all danish merchants who support both Visa and Dankort schemes has to allow Dankort/Visa cobranded cardholder to select their preferred scheme used for the payment. Thus, for this compliance purpose, the SDK now supports pre-selection of scheme between Dankort and Visa when using Dankort-Visa Co-Branded card. This allows cardholders to pre-select either Visa or Dankort scheme before initiating a payment.

By Default, Dankort is used, but if merchant wants to process transaction with Visa: the cobranded dankort card needs to be excluded as show in the following code snippet

```swift
// Only support Visa Card from supported card scheme list. 
let cardPayment = PaymentProcess.cardPayment(
    withMerchant: merchantDetails,
    excludedCardSchemeSet: [.coBrandedDankort]
    amount: amountInCents,
    currency: currencyCode) { [unowned self] userSelectedToStoreCard, callback in

           // Make the registeration call here and retrun the callback
           registerCardPayment(userSelectedToStoreCard,callback)
     }

</code></pre>

<p><em>Note:</em> If none of the schemes of Co-Branded card are excluded, Dankort would be used as default scheme by the SDK to process the payment.</p>
<pre class="highlight swift"><code>
<span class="kt">PiaSDK</span><span class="o">.</span><span class="nf">controller</span><span class="p">(</span>
    <span class="nv">for</span><span class="p">:</span> <span class="n">cardPayment</span><span class="o">.</span><span class="nf">sBusiness</span><span class="p">(),</span>
    <span class="nv">success</span><span class="p">:</span> <span class="p">{</span> <span class="n">piaController</span><span class="p">,</span> <span class="n">transactionId</span> <span class="k">in</span>  <span class="p">},</span>        <span class="c1">// Commit the transaction with your merchant backend</span>
    <span class="nv">cancellation</span><span class="p">:</span> <span class="p">{</span> <span class="n">piaController</span><span class="p">,</span> <span class="n">transactionId</span> <span class="k">in</span> <span class="p">},</span>    <span class="c1">// User canceled, rollback the transaction</span>
    <span class="nv">failure</span><span class="p">:</span> <span class="p">{</span> <span class="n">piaController</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span><span class="p">}</span>                   <span class="c1">// Rollback transaction, check error object for detail. </span>
<span class="p">)</span>
</code></pre>

<p>The following sample code demonstrates how registration results are returned to the SDK via callback. </p>
<pre class="highlight swift"><code>
<span class="n">fun</span> <span class="nf">registerCardPayment</span><span class="p">(</span><span class="n">userChoseToStoreCardForLater</span> <span class="nv">storeCard</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">,</span> <span class="nv">piaCallback</span><span class="p">:</span> <span class="p">(</span><span class="kt">TransactionID</span><span class="p">,</span> <span class="kt">RedirectURL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Make a card registration request with your backend to retrieve a transactionID and redirectURL.</span>
    <span class="c1">// The SDK passes `true` for `storeCard` if the user has checked to store the card for later use. </span>

    <span class="c1">// Callback with `transactionID` and `redirectURL` obtained from your merchant backend</span>
    <span class="nf">callback</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="nv">withTransactionID</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">transactionId</span><span class="p">,</span> <span class="nv">redirectURL</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">redirectURL</span><span class="p">))</span>

    <span class="c1">// If registration request failed with your backend, callback the SDK with the error. </span>
    <span class="nf">callback</span><span class="p">(</span><span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
<span class="p">}</span>
</code></pre>

<p>Note: Netaxept backend integration tips can be found in <em>5.4 Backend Tips</em>,  <em>Register API</em> <a href="./54-backend-tips.html#register-api">section</a></p>
<h2 id='backend-models-net-39-s-sample-merchant-backend-models' class='heading'>Backend Models - Net&rsquo;s sample merchant backend models</h2>
<h3 id='registration-request-body' class='heading'>Registration Request Body</h3>
<pre class="highlight swift"><code><span class="c1">// Note: The payment method (`PaymentMethodID`) is `SBusinessCard` for S-Business Card and `nil` for other cards </span>
<span class="c1">//       and `PaymentMethodID(id: "EasyPayment", displayName: "Easy Payment", fee: 0)`</span>
<span class="c1">//       is used for payments with a previously stored/registered card, aka easy-payment.</span>
<span class="c1">//       The `cardId` must have the card identifier token (String) for easy-payment. </span>
<span class="c1">//</span>
<span class="kd">struct</span> <span class="kt">RegistrationRequest</span><span class="p">:</span> <span class="kt">Encodable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">customerId</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">orderNumber</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">amount</span><span class="p">:</span> <span class="kt">Amount</span>
    <span class="k">let</span> <span class="nv">storeCard</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">?</span>
    <span class="k">let</span> <span class="nv">method</span><span class="p">:</span> <span class="kt">PaymentMethodID</span><span class="p">?</span>
    <span class="k">let</span> <span class="nv">cardId</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>             <span class="c1">// set for payments with a stored card</span>
    <span class="k">let</span> <span class="nv">items</span><span class="p">:</span> <span class="kt">LineItem</span><span class="p">?</span>
    <span class="k">let</span> <span class="nv">paymentData</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>        <span class="c1">// set for ApplePay payments</span>
    <span class="k">let</span> <span class="nv">phoneNumber</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>        <span class="c1">// set for Vipps payments</span>
    <span class="k">let</span> <span class="nv">redirectUrl</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>        <span class="c1">// set for Wallet App payments</span>
    <span class="k">let</span> <span class="nv">customerEmail</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>      <span class="c1">// set for Paytrail payments</span>
    <span class="k">let</span> <span class="nv">customerFirstName</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>  <span class="c1">// set for Paytrail payments</span>
    <span class="k">let</span> <span class="nv">customerLastName</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>   <span class="c1">// set for Paytrail payments</span>
    <span class="k">let</span> <span class="nv">customerAddress1</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>   <span class="c1">// set for Paytrail payments</span>
    <span class="k">let</span> <span class="nv">customerPostCode</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>   <span class="c1">// set for Paytrail payments</span>
    <span class="k">let</span> <span class="nv">customerTown</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>       <span class="c1">// set for Paytrail payments</span>
    <span class="k">let</span> <span class="nv">customerCountry</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>    <span class="c1">// set for Paytrail payments</span>
<span class="p">}</span>
</code></pre>
<h3 id='registration-response-transaction' class='heading'>Registration Response - Transaction</h3>
<pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">struct</span> <span class="kt">Transaction</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">transactionId</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">redirectOK</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">redirectCancel</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">walletUrl</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
<span class="p">}</span>
</code></pre>
<h3 id='commit-request-body' class='heading'>Commit Request Body</h3>

<p>The commit call supports two operations in our sample backend: &ldquo;COMMIT&rdquo; and &ldquo;VERIFY&rdquo;
to commit transaction and verify a registered (stored) card respectively</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Commit</span><span class="p">:</span> <span class="kt">Encodable</span> <span class="p">{</span> 
    <span class="k">let</span> <span class="nv">operation</span><span class="p">:</span> <span class="kt">String</span> 
<span class="p">}</span>
</code></pre>
<h3 id='commit-response' class='heading'>Commit Response</h3>
<pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">struct</span> <span class="kt">CommitResponse</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">transactionId</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">responseCode</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">responseSource</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">let</span> <span class="nv">responseText</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">let</span> <span class="nv">authorizationId</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">let</span> <span class="nv">executionTimestamp</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
</code></pre>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2022 <a class="link" href="https://nets.eu" target="_blank" rel="external">Nets</a>. All rights reserved. (Last updated: 2022-03-29)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.6</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
