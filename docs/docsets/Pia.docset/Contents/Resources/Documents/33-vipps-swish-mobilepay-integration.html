<!DOCTYPE html>
<html lang="en">
  <head>
    <title>3.3. Vipps, Swish, MobilePay Integration  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="3.3. Vipps, Swish, MobilePay Integration  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Pia Docs
        </a>
         (68% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">Pia Reference</a>
      <img class="carat" src="img/carat.png" />
      3.3. Vipps, Swish, MobilePay Integration  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="0-getting-started.html">0. Getting started</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="11-basic-payment-flow.html">1.1. Basic payment flow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="12-easy-one-click-payment-flow.html">1.2. Easy (one click) payment flow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="13-recurring-payments.html">1.3. Recurring payments</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="2-saving-a-card.html">2. Saving a card</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="31-apple-pay-integration.html">3.1. Apple Pay Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="32-paypal-integration.html">3.2. PayPal Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="33-vipps-swish-mobilepay-integration.html">3.3. Vipps, Swish, MobilePay Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="34-finland---direct-bank-payment-via-paytrail.html">3.4. Finland - Direct bank payment (via Paytrail)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="4-ui-customization.html">4. UI Customization</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="51-error-codes-handling.html">5.1. Error Codes Handling</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="52-terminology.html">5.2. Terminology</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="53-faqs.html">5.3. FAQs</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="54-backend-tips.html">5.4. Backend Tips</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="6-licenses.html">6. Licenses</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="7-changelog.html">7. Changelog</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="8-get-in-touch.html">8. Get in touch</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Categories.html">Categories</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Categories/NSError_28Wallets_29.html">NSError(Wallets)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CardDisplay.html">CardDisplay</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CardPayment.html">CardPayment</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CardPaymentProcess.html">CardPaymentProcess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CardRegistrationResponse.html">CardRegistrationResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CardStorage.html">CardStorage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MerchantDetails.html">MerchantDetails</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIApplePayInfo.html">NPIApplePayInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIApplePayShippingInfo.html">NPIApplePayShippingInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIError.html">NPIError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIInterfaceConfiguration.html">NPIInterfaceConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIMerchantInfo.html">NPIMerchantInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPIOrderInfo.html">NPIOrderInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPITokenCardInfo.html">NPITokenCardInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NPITransactionInfo.html">NPITransactionInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PayPalPaymentProcess.html">PayPalPaymentProcess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PayPalRegistrationResponse.html">PayPalRegistrationResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PaymentProcess.html">PaymentProcess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PaytrailPaymentProcess.html">PaytrailPaymentProcess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PaytrailRegistrationResponse.html">PaytrailRegistrationResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PiaSDK.html">PiaSDK</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PiaSDKController.html">PiaSDKController</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/RegistrationResponse.html">RegistrationResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TokenizedCardExpressCheckout.html">TokenizedCardExpressCheckout</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TokenizedCardPayment.html">TokenizedCardPayment</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TokenizedCardPrompt.html">TokenizedCardPrompt</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TokenizedCardPromptConfirmation.html">TokenizedCardPromptConfirmation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes.html#/c:objc(cs)TokenizedCardPromptNone">TokenizedCardPromptNone</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/WalletPaymentProcess.html">WalletPaymentProcess</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/WalletRegistrationResponse.html">WalletRegistrationResponse</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Constants.html">Constants</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@NPIPiaSemanticVersionString">NPIPiaSemanticVersionString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@NPIPiaTechnicalVersionString">NPIPiaTechnicalVersionString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@PiaVersionNumber">PiaVersionNumber</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@PiaVersionString">PiaVersionString</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Card.html">Card</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/CardScheme.html">CardScheme</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PayButtonTextLabelOption.html">PayButtonTextLabelOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PiALanguage.html">PiALanguage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/SchemeType.html">SchemeType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Wallet.html">Wallet</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/WalletErrorCode.html">WalletErrorCode</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PaymentRegistering.html">PaymentRegistering</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PaymentRegistrationResult.html">PaymentRegistrationResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PiaSDKDelegate.html">PiaSDKDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PiaSDKTheme.html">PiaSDKTheme</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Type%20Definitions.html">Type Definitions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@CardError">CardError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@CardRegistrationCallback">CardRegistrationCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@CompletionCallback">CompletionCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentProcess.h@T@Currency">Currency</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@FailureCompletionCallback">FailureCompletionCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions/NPIErrorCode.html">NPIErrorCode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@PayPalRegistrationCallback">PayPalRegistrationCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@PaymentProcessCompletion">PaymentProcessCompletion</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@PaymentProcessFailure">PaymentProcessFailure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@PaytrailRegistrationCallback">PaytrailRegistrationCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@RedirectURL">RedirectURL</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@TokenizableCardRegistrationCallback">TokenizableCardRegistrationCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@TokenizeCardForLaterUse">TokenizeCardForLaterUse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@TransactionCallback">TransactionCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@TransactionCompletion">TransactionCompletion</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@TransactionID">TransactionID</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:NSError+Wallets.h@T@WalletError">WalletError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@WalletFailureWithError">WalletFailureWithError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@WalletRedirectWithoutInterruption">WalletRedirectWithoutInterruption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@WalletURL">WalletURL</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Definitions.html#/c:PaymentRegistration.h@T@WalletURLCallback">WalletURLCallback</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/c:@F@isSBusinessInitiated">isSBusinessInitiated</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <h1 id='wallets-vipps-swish-mobilepay-integration' class='heading'>Wallets (Vipps, Swish, MobilePay) Integration</h1>

<p>Pia SDK supports Vipps, Swish and MobilePay wallets with a straightforward and easy integration. App-switch to and from the wallet apps is handled by the SDK covering all UX scenarios and corner cases from start to finish. A single declarative API is used to initiate a wallet payment process with callbacks for <em>payment registration, redirect</em> and <em>failure</em> invoked by the SDK. </p>

<p>In order to initiate a wallet payment: </p>
<pre class="highlight swift"><code><span class="c1">/// Initiating a wallet-payment. Returns `false` if the wallet app cannot be opened; </span>
<span class="c1">/// It not installed or your app is missing URL scheme in info.plist for the wallet-app.</span>
<span class="c1">/// </span>
<span class="c1">/// paymentProcess: Identifies the wallet process. </span>
<span class="c1">/// walletURLCallback: Callback with `walletURL` obtained from registration request</span>
<span class="c1">///                    with merchant backend. Callback with error if unsuccessful</span>
<span class="c1">/// redirectWithoutInterruption: Callback with value `true` if app-switch was successful.</span>
<span class="c1">/// failure: Callback notifying failure typically to launch the wallet app. Contains `error` for details. </span>
<span class="c1">///</span>
<span class="k">let</span> <span class="nv">canLaunch</span> <span class="o">=</span> <span class="kt">PiaSDK</span><span class="o">.</span><span class="nf">launchWalletApp</span><span class="p">(</span>
    <span class="nv">for</span><span class="p">:</span> <span class="kt">PaymentProcess</span><span class="o">.</span><span class="nf">walletPayment</span><span class="p">(</span><span class="o">.</span><span class="n">vipps</span> <span class="o">/</span> <span class="o">.</span><span class="n">vippsTest</span> <span class="o">/</span> <span class="o">.</span><span class="n">swish</span> <span class="o">/</span> <span class="o">.</span><span class="n">mobilePay</span><span class="p">),</span>
    <span class="nv">walletURLCallback</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="nf">registerWalletPayment</span><span class="p">(</span><span class="nv">callback</span><span class="p">:),</span> <span class="c1">// see registration section</span>
    <span class="nv">redirectWithoutInterruption</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="nf">walletAppDidRedirect</span><span class="p">(</span><span class="nv">withoutInterruption</span><span class="p">:),</span> <span class="c1">// see redirect handling section</span>
    <span class="nv">failure</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="nf">walletDidFail</span><span class="p">(</span><span class="nv">withError</span><span class="p">:)</span> <span class="c1">// see error handling section</span>
<span class="p">}</span>

<span class="k">if</span> <span class="o">!</span><span class="n">canLaunch</span> <span class="p">{</span> <span class="cm">/* Wallet app is not installed, preferably lead user to other payment methods */</span> <span class="p">}</span>
</code></pre>
<h2 id='wallet-app-detection' class='heading'>Wallet App Detection</h2>

<p>The <code>launchWalletApp</code> wallet API, returns <code>nil</code> if the wallet app cannot be launched. </p>

<p>The SDK checks this as the first step in the process preventing unnecessary payment registration. If the wallet app is not installed on user&rsquo;s device, we recommend leading user to other available payment methods.
On the other hand, the SDK returns <code>wallet app not installed</code> error in the corner case where user uninstalls the wallet app after payment has been registered with merchant backend.</p>

<p>In order for the PiA SDK to perform app detection, you need to the wallet app schemes (shown below) under the <code>LSApplicationQueriesSchemes</code> key in your <strong>Info.plist</strong> file. If you skip this step, the PiA SDK will always return <code>wallet app cannot open</code> error even though Vipps app is installed on the device. </p>
<h3 id='vipps' class='heading'>Vipps</h3>
<pre class="highlight plaintext"><code>&lt;key&gt;LSApplicationQueriesSchemes&lt;/key&gt;
&lt;array&gt;
    &lt;string&gt;vipps&lt;/string&gt;
    &lt;string&gt;vippsMT&lt;/string&gt;
&lt;/array&gt;
</code></pre>
<h3 id='swish' class='heading'>Swish</h3>
<pre class="highlight plaintext"><code>&lt;key&gt;LSApplicationQueriesSchemes&lt;/key&gt;
&lt;array&gt;
    &lt;string&gt;swish&lt;/string&gt;
&lt;/array&gt;
</code></pre>
<h3 id='mobilepay' class='heading'>MobilePay</h3>
<pre class="highlight plaintext"><code>&lt;key&gt;LSApplicationQueriesSchemes&lt;/key&gt;
&lt;array&gt;
    &lt;string&gt;mobilepayonline&lt;/string&gt;
    &lt;string&gt;mobilepayonline-test&lt;/string&gt;
&lt;/array&gt;
</code></pre>
<h2 id='wallet-payment-registration' class='heading'>Wallet Payment Registration</h2>

<p>Register the wallet payment with your merchant backend in order to obtain a <code>walletURL</code> which the SDK uses to launch the wallet app. Regardless of success or failure when making registration request with your merchant backend, make sure to callback the SDK with <code>success</code> or <code>failure</code> results. The following shows an example of these callbacks:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">registerWalletPayment</span><span class="p">(</span><span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">WalletRegistrationResponse</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Make registration API call to your backend to obtain `walletURL`</span>
    <span class="c1">// redirectURL should have this format - "your_app_scheme://piasdk?wallet=walletName" (walletName = vipps/swish/mobilepay)</span>
    <span class="nf">callback</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="nv">withWalletURL</span><span class="p">:</span> <span class="n">walletURl</span><span class="p">))</span>

    <span class="c1">// If unsuccessful, notify SDK with an error object</span>
    <span class="nf">callback</span><span class="p">(</span><span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">))</span> 
<span class="p">}</span>
</code></pre>

<p>Note : Vipps and Mobilepay support <strong>AUTH+CAPTURE</strong> process. If <strong>autoSale</strong> is set to &ldquo;true&rdquo;, Netaxept authorizes and immediately captures the amount set in the <strong>REGISTER</strong> call. It is optional and default value is false (authorization only and capture from the backend with additional process call).</p>
<h3 id='vipps-payment-registration' class='heading'>Vipps Payment Registration</h3>

<p>In case of Vipps, user&rsquo;s phone number is an optional parameter. If you choose not to pass the phone number, you need to additionally pass the <code>isApp = true</code> parameter in the registration <em>request body</em>. If choosing to pass user&rsquo;s phone number, use the following format: (Norwegian prefix): <code>phoneNumber = +4711111111</code>. Netaxept REST API expects URL encoded phone number. The encoding can take place in the client or merchant backend.  </p>
<h2 id='wallet-app-redirect' class='heading'>Wallet App Redirect</h2>

<p>All redirects to your application are received in <code>AppDelegate</code> open URL delegate method. Notify the SDK of a wallet app redirect as follows:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">app</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="kd">open</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplicationOpenURLOptionsKey</span> <span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:])</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="o">!</span><span class="kt">PiaSDK</span><span class="o">.</span><span class="nf">willHandleRedirect</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">andOptions</span><span class="p">:</span> <span class="n">options</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// SDK has handled the redirect and will invoke the `redirect` callback explained below</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// This was not a wallet app redirect, handle accordingly</span>

    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>

<p>Use the <code>redirectWithoutInterruption: (Bool) -&gt; Void</code> callback to handle successful redirect or potentially interruption caused by user manually returning to your app. See example below:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">walletAppDidRedirect</span><span class="p">(</span><span class="n">withoutInterruption</span> <span class="nv">successfulRedirect</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// `successfulRedirect` is false incase of interruptions</span>

    <span class="c1">// Make a query request to your backend to check payment status. </span>
    <span class="c1">// and commit/rollback the transaction accordingly. </span>

    <span class="c1">// Scenarios:</span>

    <span class="k">if</span> <span class="n">successfulRedirect</span> <span class="p">{</span> <span class="kt">Wallet</span> <span class="n">app</span> <span class="n">redirected</span> <span class="n">to</span> <span class="n">your</span> <span class="n">app</span> <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// User manually returned to your app after authorizing, declining or </span>
        <span class="c1">// possibly without any action at the wallet app. </span>
    <span class="p">}</span>

    <span class="c1">// Payment status in either case can only be obtained from your merchant backend.</span>
    <span class="k">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">commitPayment</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span> 

        <span class="c1">// Present result to user accordingly </span>

        <span class="c1">// Remove the activity indicator presented by the SDK</span>
        <span class="kt">PiaSDK</span><span class="o">.</span><span class="nf">removeTransitionView</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='wallet-payments-cases-of-interrupted-transactions' class='heading'>Wallet payments - Cases of interrupted transactions</h3>

<p>The typical payment flow via mobile wallets starts from the app where transaction registration request is sent to merchant backend. Upon receiving a wallet URL, the SDK launches the wallet app. 
The wallet app then redirects back to the application and PiaSDK notifies the associated wallet payment delegate to complete the transaction. </p>

<p>However, </p>

<ul>
<li>User may interrupt this flow e.g. by manually navigating to your application before completing authorization at the wallet app or</li>
<li>The wallet app may fail to redirect for an unknown reason forcing the user to manually return to your application</li>
</ul>

<p>In these and related scenarios, PiaSDK notifies interruption through in the callback <code>redirectWithoutInterruption</code> by returning false:</p>

<p>Upon receiving interruption, it&rsquo;s best to query the transaction status and check if the authorization was complete or has been interrupted/denied in the wallet app. 
(If the user navigates back to the wallet app for authorization resulting in a successful redirect to your app, 
PiaSDK will notify the redirect where the app can commit / rollback the transaction accordingly)</p>
<h2 id='error-handling' class='heading'>Error Handling</h2>

<p>The last callback in the wallet API is dedicated to error handling - <code>failure: (WalletError) -&gt; Void</code>. In most cases, failing to launch a wallet app is communicated in the return value of the launch API - <code>let canLaunch = PiaSDK.launchWalletAp(…)</code>. However, in the corner cases where user uninstalls the wallet app after the process has started, the SDK invokes this failure callback. </p>

<p>Here are the 2 scenarios where a failure callback might be invoked (and one more scenario specific to <em>MobilePay</em>): </p>

<ul>
<li><em>Invalid <code>walletURL</code>:</em> Indicates failure to launch the wallet app with given <code>walletURL</code>. Check the validity of this URL returned from your merchant backend.</li>
<li><em>Wallet App Not Installed:</em> Lead user to a different payment method.</li>
<li><em>Network Error - Specific to MobilePay:</em> Indicates network issues while attempting to launch MobilePay. Remind user to check their network connection or optionally lead to a different payment method.</li>
</ul>
<h2 id='additional-settings' class='heading'>Additional Settings</h2>

<p>The SDK presents an activity indicator in the transitions to and from a wallet app. A root view of your application (<code>UIApplication.shared.rootViewController.view</code>) is used to display the activity indicator simultaneously preventing any user interaction. </p>

<p>However, if you choose to replace this activity indicator with your own, use the <code>showsActivityIndicator</code> parameter:</p>

<p><code>PaymentProcess.walletPayment(for: wallet, showActivityIndicator: false)</code></p>

<p>In this case, you&rsquo;re responsible to block user interactions while the wallet payment is in progress. </p>
<h2 id='vipps-payment-diagram' class='heading'>Vipps Payment Diagram</h2>

<p>Here are the flow diagram for Vipps payment:</p>

<p><img src="./img/Vipps%20Payment%20Flow.png" alt="Vipps Payment Flow"></p>

<table><thead>
<tr>
<th style="text-align: center">Vipps Flow</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center"><img src="./Resources/VippsFlow.gif" alt=""></td>
</tr>
</tbody></table>
<h2 id='swish-payment-diagram' class='heading'>Swish Payment Diagram</h2>

<p>Here is the flow diagram for Swish payment:</p>

<p><img src="./img/Swish%20Payment%20Flow.png" alt="Swish Payment Flow"></p>

<table><thead>
<tr>
<th style="text-align: center">Swish Flow</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center"><img src="./Resources/SwishFlow.gif" alt=""></td>
</tr>
</tbody></table>
<h2 id='mobilepay-payment-diagram' class='heading'>MobilePay Payment Diagram</h2>

<p>Here is the flow diagram for MobilePay payment:</p>

<p><img src="./img/MobilePay%20Flow.png" alt="MobilePay Flow"></p>

<table><thead>
<tr>
<th style="text-align: center">MobilePay Flow</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center"><img src="./Resources/MobilePayFlow.gif" alt=""></td>
</tr>
</tbody></table>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2022 <a class="link" href="https://nets.eu" target="_blank" rel="external">Nets</a>. All rights reserved. (Last updated: 2022-03-29)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.6</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
